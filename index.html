<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>COMO — Player</title>
  <meta name="theme-color" content="#1b1410"/>

  <!-- فونت لاله‌زار (لوکال) → فایل را در ./fonts/Lalezar-Regular.woff2 قرار دهید -->
  <style>
    @font-face{font-family:'Lalezar';src:url('./fonts/Lalezar-Regular.woff2') format('woff2');font-weight:400;font-style:normal;font-display:swap}
    :root{--ff:'Lalezar',system-ui,-apple-system,Segoe UI,Roboto,Arial}
  </style>

  <style>
    /* پالت پاییزی و گلس */
    :root{
      --bg:#0f0f10;
      --fg:#f5f5f5;
      --muted:#9aa0a6;
      --brand:#ff9b45;    /* نارنجی پاییزی */
      --brand-2:#ffd185;  /* طلایی گرم */
      --glass: rgba(255,255,255,.08);
      --glass-bd: rgba(255,255,255,.18);
      --bean:#6b3e2e;     /* قهوه‌ای دونه */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 800px at 20% -10%, #1d1b17 0%, transparent 60%),radial-gradient(900px 700px at 120% 10%, #2a221c 0%, transparent 60%),var(--bg);color:var(--fg);font-family:var(--ff)}

    .wrap{min-height:100%;display:grid;place-items:center;padding:24px}

    /* بک‌گراند از کاور (بلر) → cover.jpg را کنار فایل بگذارید */
    .hero-bg{position:fixed;inset:0;background:url('./cover.jpg') center/cover no-repeat;filter:blur(20px) brightness(.55) saturate(.9);opacity:.85;z-index:-3}
    .scrim{position:fixed;inset:0;background:radial-gradient(60vw 60vh at 50% 30%, rgba(0,0,0,.25) 0%, rgba(0,0,0,.75) 70%, rgba(0,0,0,.9) 100%);z-index:-2}

    /* بارش دونه‌های قهوه */
    .beans{position:fixed;inset:0;pointer-events:none;z-index:-1}
    .bean{position:absolute;width:14px;height:20px;background:var(--bean);border-radius:14px/20px;opacity:.22}
    .bean::after{content:"";position:absolute;inset:0;border-left:3px solid rgba(255,255,255,.26);border-radius:14px/20px}
    @keyframes fall{0%{transform:translateY(-15vh) rotate(0deg)}100%{transform:translateY(115vh) rotate(200deg)}}

    .player{width:min(900px,96vw);display:grid;grid-template-columns: 1.1fr .9fr;gap:18px;align-items:center;background:var(--glass);backdrop-filter:blur(14px);border:1px solid var(--glass-bd);border-radius:20px;box-shadow:0 30px 80px rgba(0,0,0,.45);overflow:hidden}
    @media (max-width:860px){.player{grid-template-columns:1fr}}

    /* سمت چپ: کاور و لوگو → logo.png را کنار فایل بگذارید */
    .cover{position:relative;aspect-ratio:1/1;background:#1a1a1a}
    .cover img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .logo{position:absolute;top:12px;left:12px;background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.16);backdrop-filter: blur(8px);border-radius:12px;padding:8px}
    .logo img{width:72px;height:auto;display:block}

    /* سمت راست: اطلاعات و کنترل‌ها */
    .pane{padding:18px 18px 16px}
    .title{font-size:clamp(20px,3.8vw,26px);font-weight:800;letter-spacing:.02em}
    .subtitle{font-size:14px;color:var(--muted);margin-top:4px}
    .tag-fa{margin-top:8px;font-size:14px;opacity:.9}

    /* نوار پیشرفت */
    .progress{margin:16px 0}
    .bar{position:relative;height:10px;background:rgba(255,255,255,.12);border-radius:999px;cursor:pointer}
    .bar-fill{position:absolute;inset:0 0 0 0;width:0%;background:linear-gradient(90deg,var(--brand),var(--brand-2));border-radius:999px}
    .thumb{position:absolute;top:50%;transform:translate(-50%,-50%);left:0%;width:18px;height:18px;border-radius:50%;background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.4)}
    .times{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:6px}

    /* ویوفورم */
    .wave-wrap{margin-top:10px;background:rgba(255,255,255,.06);border:1px solid var(--glass-bd);border-radius:12px;padding:8px}
    canvas#wave{display:block;width:100%;height:88px}

    /* دکمه‌ها */
    .controls{display:flex;align-items:center;gap:10px;margin-top:10px}
    .btn{display:inline-grid;place-items:center;width:44px;height:44px;border-radius:12px;border:1px solid var(--glass-bd);background:rgba(255,255,255,.06);cursor:pointer;transition:transform .15s ease, background .2s ease}
    .btn:hover{transform:translateY(-1px);background:rgba(255,255,255,.12)}
    .btn:active{transform:translateY(0)}
    .btn.primary{width:60px;height:60px;border-radius:16px;background:linear-gradient(180deg,var(--brand),#e27c32);border:0;box-shadow:0 12px 28px rgba(226,124,50,.35)}

    .vol{margin-inline-start:auto;display:flex;align-items:center;gap:8px}
    input[type=range]{-webkit-appearance:none;width:120px;height:10px;background:rgba(255,255,255,.12);border-radius:999px}
    input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:#fff;box-shadow:0 1px 6px rgba(0,0,0,.4)}

    .chips{display:flex;gap:8px;margin-top:12px}
    .chip{font-size:12px;color:#111;background:linear-gradient(180deg,#ffd185,#ffb35a);border-radius:999px;padding:6px 10px;font-weight:800}

    @media (prefers-reduced-motion: reduce){ .btn,.player{transition:none} }
  </style>
</head>
<body>
  <div class="hero-bg" aria-hidden="true"></div>
  <div class="scrim" aria-hidden="true"></div>
  
  <!-- بارش دونه‌های قهوه: تعداد/سرعت با nth-child متنوع شده -->
  <div class="beans" aria-hidden="true">
    <span class="bean" style="left:8%; animation:fall 14s linear -2s infinite"></span>
    <span class="bean" style="left:18%; transform:scale(.9); animation:fall 18s linear -6s infinite"></span>
    <span class="bean" style="left:28%; transform:scale(1.2); animation:fall 16s linear -4s infinite"></span>
    <span class="bean" style="left:42%; animation:fall 20s linear -8s infinite"></span>
    <span class="bean" style="left:56%; transform:scale(1.1); animation:fall 15s linear -3s infinite"></span>
    <span class="bean" style="left:70%; transform:scale(.85); animation:fall 19s linear -5s infinite"></span>
    <span class="bean" style="left:82%; transform:scale(1.3); animation:fall 17s linear -7s infinite"></span>
  </div>

  <div class="wrap">
    <section class="player" aria-label="COMO player">
      <figure class="cover">
        <img src="./cover.jpg" alt="Track cover"/>
        <div class="logo"><img src="./logo.png" alt="COMO logo"/></div>
      </figure>

      <div class="pane">
        <!-- عناوین انگلیسی -->
        <div class="title">COMO — Cafe Theme</div>
        <div class="subtitle">Single • Loop • Autumn Vibes</div>
        <!-- فقط شعار فارسی -->
        <div class="tag-fa">ابری با احتمال بارش دونه‌های قهوه</div>

        <div class="progress" aria-label="progress">
          <div class="bar" id="bar">
            <div class="bar-fill" id="fill"></div>
            <div class="thumb" id="thumb" aria-hidden="true"></div>
          </div>
          <div class="times"><span id="cur">0:00</span><span id="dur">0:00</span></div>
        </div>

        <!-- ویوفورم -->
        <div class="wave-wrap" aria-hidden="false">
          <canvas id="wave"></canvas>
        </div>

        <div class="controls">
          <button class="btn" id="back" title="Back 10s" aria-label="Back 10 seconds">⟲</button>
          <button class="btn primary" id="play" title="Play/Pause" aria-label="Play/Pause">▶</button>
          <button class="btn" id="fwd" title="Forward 10s" aria-label="Forward 10 seconds">⟳</button>

          <div class="vol" title="Volume">
            <span style="font-size:14px">🔊</span>
            <input id="vol" type="range" min="0" max="1" step="0.01" value="0.9"/>
          </div>
        </div>

        <div class="chips">
          <span class="chip">Glass</span>
          <span class="chip">Minimal</span>
          <span class="chip">Dark</span>
        </div>
      </div>
    </section>
  </div>

  <!-- ترک را به نام track.mp3 در کنار فایل قرار دهید -->
  <audio id="audio" src="./track.mp3" preload="auto" loop playsinline></audio>

  <script>
    (function(){
      const a = document.getElementById('audio');
      const play = document.getElementById('play');
      const back = document.getElementById('back');
      const fwd  = document.getElementById('fwd');
      const vol  = document.getElementById('vol');
      const bar  = document.getElementById('bar');
      const fill = document.getElementById('fill');
      const thumb= document.getElementById('thumb');
      const cur  = document.getElementById('cur');
      const dur  = document.getElementById('dur');

      // Autoplay: بی‌صدا برای سازگاری با موبایل؛ با کلیک کاربر صدا فعال می‌شود
      a.muted = true; a.volume = parseFloat(vol.value);
      function fmt(t){ if(!isFinite(t)) return '0:00'; const m=Math.floor(t/60); const s=Math.floor(t%60).toString().padStart(2,'0'); return `${m}:${s}` }
      function setProgress(p){ p = Math.max(0, Math.min(1, p)); fill.style.width = (p*100)+'%'; thumb.style.left = (p*100)+'%'; }
      function update(){ setProgress(a.currentTime / (a.duration||1)); cur.textContent = fmt(a.currentTime); dur.textContent = fmt(a.duration||0); }

      a.addEventListener('loadedmetadata', update);
      a.addEventListener('timeupdate', update);
      a.play().catch(()=>{});

      play.addEventListener('click', async ()=>{
        try{
          if(a.paused){ if(a.muted) a.muted=false; await a.play(); play.textContent='⏸'; }
          else{ a.pause(); play.textContent='▶'; }
        }catch(e){}
      });
      back.addEventListener('click', ()=>{ a.currentTime = Math.max(0, a.currentTime - 10); });
      fwd.addEventListener('click',  ()=>{ a.currentTime = Math.min(a.duration||a.currentTime+10, a.currentTime + 10); });
      vol.addEventListener('input', ()=>{ a.volume = parseFloat(vol.value); if(a.volume>0) a.muted=false; });

      let dragging=false;
      function seekFromEvent(ev){ const rect = bar.getBoundingClientRect(); const x = (ev.clientX||ev.touches?.[0]?.clientX) - rect.left; const p = x/rect.width; a.currentTime = (a.duration||0) * Math.max(0,Math.min(1,p)); }
      bar.addEventListener('pointerdown', (e)=>{ dragging=true; seekFromEvent(e); });
      window.addEventListener('pointermove', (e)=>{ if(dragging) seekFromEvent(e); });
      window.addEventListener('pointerup',   ()=>{ dragging=false; });

      // کیبورد
      window.addEventListener('keydown', (e)=>{
        if(e.code==='Space'){ e.preventDefault(); play.click(); }
        if(e.code==='ArrowLeft'){ a.currentTime = Math.max(0, a.currentTime-5); }
        if(e.code==='ArrowRight'){ a.currentTime = Math.min(a.duration||a.currentTime+5, a.currentTime+5); }
      });

      // Web Audio API: ویوفورم زنده
      let ctx, src, analyser, data;
      const canvas = document.getElementById('wave');
      const dpr = Math.max(1, window.devicePixelRatio||1);
      function resize(){ const w = canvas.clientWidth, h = canvas.clientHeight; canvas.width = Math.floor(w*dpr); canvas.height = Math.floor(h*dpr); }
      resize();
      window.addEventListener('resize', resize);

      function setupAudio(){
        if(ctx) return;
        try{
          ctx = new (window.AudioContext||window.webkitAudioContext)();
          src = ctx.createMediaElementSource(a);
          analyser = ctx.createAnalyser();
          analyser.fftSize = 1024; // متعادل برای موبایل
          data = new Uint8Array(analyser.frequencyBinCount);
          src.connect(analyser); analyser.connect(ctx.destination);
        }catch(e){}
      }

      function draw(){
        const c = canvas.getContext('2d');
        c.clearRect(0,0,canvas.width,canvas.height);
        if(!analyser){ requestAnimationFrame(draw); return; }
        analyser.getByteTimeDomainData(data);
        const W = canvas.width, H = canvas.height; const mid = H/2;
        c.lineWidth = Math.max(2, 2*dpr);
        const grad = c.createLinearGradient(0,0,W,0); grad.addColorStop(0,'#ff9b45'); grad.addColorStop(1,'#ffd185');
        c.strokeStyle = grad; c.beginPath();
        const step = Math.max(1, Math.floor(data.length / W));
        for(let x=0, i=0; x<W; x+=1, i+=step){ const v = (data[i]-128)/128; const y = mid + v * (H*0.42); if(x===0) c.moveTo(x,y); else c.lineTo(x,y); }
        c.stroke();
        requestAnimationFrame(draw);
      }
      draw();

      // هنگام اولین تعامل، کانتکست را فعال کن تا در iOS هم کار کند
      const resume = ()=>{ if(ctx && ctx.state==='suspended') ctx.resume(); else setupAudio(); };
      document.addEventListener('pointerdown', resume, {passive:true});
      document.addEventListener('keydown', resume);
    })();
  </script>
</body>
</html>
